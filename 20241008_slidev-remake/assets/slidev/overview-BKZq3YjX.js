import{q as te,r as oe,i as ne,s as le}from"../modules/unplugin-icons-hJOaby8D.js";import{d as J,U as ie,P as se,t as T,V as ae,G as F,H as ce,W as re,n as Y,J as c,o as i,c as g,i as D,h as L,X as ue,Y as de,b,j as me,Z as pe,A,_ as fe,L as ve,e as a,F as O,S as q,k as N,x as y,g as I,l as w}from"../modules/vue-BxkSfgn6.js";import{j as he,k as ge,o as ke,C as X,p as G}from"../index-DDHR5GS5.js";import{d as _e,i as be,e as W,f as xe,p as ye}from"../monaco/bundled-types-DfaZohK2.js";import{u as we,S as Ce}from"./SlideContainer-nyDV4nqt.js";import{S as $e}from"../SlideWrapper-B_Gfrcvw.js";import{_ as Se}from"./DrawingPreview.vue_vue_type_script_setup_true_lang-C2odlIAy.js";import{_ as K}from"./IconButton.vue_vue_type_script_setup_true_lang-DCsPMThp.js";import{_ as De}from"./NoteDisplay.vue_vue_type_style_index_0_lang-3QQzNSJm.js";import{C as Ee}from"./ClicksSlider-D1kjDKav.js";import"../modules/shiki-B0Vi0BHB.js";import"../modules/file-saver-igGfcqei.js";import"./context-CtAL68qA.js";const He=["placeholder"],Me=J({__name:"NoteEditable",props:{no:{type:Number,required:!0},class:{default:""},editing:{default:!1},style:{default:()=>({})},placeholder:{default:"No notes for this slide"},clicksContext:{type:Object},highlight:{default:!0},autoHeight:{default:!1}},emits:["update:editing","markerDblclick","markerClick"],setup(C,{emit:R}){const n=C,x=R,r=ie(n,"editing",x,{passive:!0}),{info:v,update:$}=we(se(n,"no")),p=T("");let E;const{ignoreUpdates:k}=ae(p,s=>{if(!r.value)return;const m=n.no;clearTimeout(E),E=setTimeout(()=>{$({note:s},m)},500)});F(()=>{var s;return(s=v.value)==null?void 0:s.note},(s="")=>{r.value||(clearTimeout(E),k(()=>{p.value=s}))},{immediate:!0,flush:"sync"});const d=T(),_=T();ce(()=>{var s;r.value&&((s=d.value)==null||s.focus())}),re(d,()=>{r.value=!1});function V(){!n.autoHeight||!d.value||!r.value||d.value.scrollHeight>d.value.clientHeight&&(d.value.style.height=`${d.value.scrollHeight}px`)}function z(s){r.value&&s.metaKey&&s.key==="s"&&(s.preventDefault(),$({note:p.value},n.no))}return F([p,r],()=>{Y(()=>{V()})},{flush:"post",immediate:!0}),(s,m)=>{var H;return c(r)?ue((i(),b("textarea",{key:1,ref_key:"inputEl",ref:d,"onUpdate:modelValue":m[2]||(m[2]=h=>p.value=h),class:D(["prose resize-none overflow-auto outline-none bg-transparent block border-primary border-2",n.class]),style:L([{"line-height":"1.75"},[n.style,_.value!=null?{height:`${_.value}px`}:{}]]),placeholder:C.placeholder,onKeydown:[m[3]||(m[3]=me(h=>r.value=!1,["esc"])),z]},null,46,He)),[[de,p.value]]):(i(),g(De,{key:0,class:D(["border-transparent border-2",[n.class,p.value?"":"opacity-25 italic select-none"]]),style:L(n.style),note:p.value||C.placeholder,"note-html":(H=c(v))==null?void 0:H.noteHTML,"clicks-context":C.clicksContext,"auto-scroll":!C.autoHeight,highlight:n.highlight,onMarkerClick:m[0]||(m[0]=(h,M)=>x("markerClick",h,M)),onMarkerDblclick:m[1]||(m[1]=(h,M)=>x("markerDblclick",h,M))},null,8,["class","style","note","note-html","clicks-context","auto-scroll","highlight"]))}}}),Ne={class:"h-screen w-screen of-hidden flex"},Te={class:"grid grid-rows-[auto_max-content] border-r border-main select-none max-h-full h-full"},Ve={class:"relative"},Be={class:"absolute left-0 top-0 bottom-0 w-200 flex flex-col flex-auto items-end group p2 gap-1 max-h-full of-x-visible of-y-auto",style:{direction:"rtl"}},Ie=["onClick"],We={p2:"",border:"t main"},Ke={class:"select-none w-13 text-right my4 flex flex-col gap-1 items-end"},Le={class:"text-3xl op20 mb2"},ze=["onDblclick"],Ae={class:"py3 mt-0.5 mr--8 ml--4 op0 transition group-hover:op100"},Pe={key:0,class:"select-none absolute bottom-0 right-0 bg-main rounded-tl p2 op35 text-xs"},Re={class:"absolute top-0 right-0 px3 py1.5 border-b border-l rounded-lb bg-main border-main select-none"},Ue={class:"text-xs op50"},P=450,lt=J({__name:"overview",setup(C){he({title:`Overview - ${_e}`});const{openInEditor:R,slides:n}=ge(),x=pe(new Map),r=T([]),v=T(null),$=A(()=>n.value.map(t=>{var e,l;return s(((l=(e=t.meta)==null?void 0:e.slide)==null?void 0:l.note)||"")})),p=A(()=>$.value.reduce((t,e)=>t+e,0)),E=A(()=>n.value.map(t=>V(t)).reduce((t,e)=>t+e,0)),k=fe(),d=new WeakMap;function _(t){return d.has(t)||d.set(t,ke(t,X)),d.get(t)}function V(t){var e,l;return((e=t.meta)==null?void 0:e.clicks)||((l=_(t))==null?void 0:l.total)}function z(t){k.value===t?k.value=void 0:k.value=t}function s(t){var e;return((e=t.match(/[\w`'\-]+/g))==null?void 0:e.length)||0}function m(t){const e=t.getBoundingClientRect(),l=20;return e.top>=0-l&&e.left>=0-l&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)+l&&e.right<=(window.innerWidth||document.documentElement.clientWidth)+l}function H(){const t=[];Array.from(x.entries()).forEach(([e,l])=>{m(l)&&t.push(e)}),r.value=t}function h(t){const e=document.createElement("a");e.target="_blank",e.href=ye+t.slice(1),e.click()}function M(t){const e=x.get(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}function Z(t,e,l){const S=_(l);S.current===e?S.current=X:S.current=e,t.preventDefault()}return ve(()=>{Y(()=>{H()})}),(t,e)=>{const l=te,S=oe,Q=ne,ee=le;return i(),b("div",Ne,[a("nav",Te,[a("div",Ve,[a("div",Be,[(i(!0),b(O,null,q(c(n),(o,f)=>{var u,B,U,j;return i(),b("div",{key:o.no,class:"relative",style:{direction:"ltr"}},[a("button",{class:D(["relative transition duration-300 w-8 h-8 rounded hover:bg-active hover:op100",r.value.includes(f)?"op100 text-primary bg-gray:5":"op20"]),onClick:je=>M(f)},[a("div",null,y(f+1),1)],10,Ie),(B=(u=o.meta)==null?void 0:u.slide)!=null&&B.title?(i(),b("div",{key:0,class:D(["pointer-events-none select-none absolute left-110% backdrop-blur-8 top-50% translate-y--50% ws-nowrap z-10 px2 shadow-xl rounded border border-main transition duration-400 op0 group-hover:op100",r.value.includes(f)?"text-primary":"text-main important-text-op-50"])},y((j=(U=o.meta)==null?void 0:U.slide)==null?void 0:j.title),3)):I("v-if",!0)])}),128))])]),a("div",We,[c(be)?(i(),g(K,{key:1,title:c(W)?"Dark mode":"Light mode","pointer-events-none":"",op50:""},{default:N(()=>[c(W)?(i(),g(l,{key:0})):(i(),g(S,{key:1}))]),_:1},8,["title"])):(i(),g(K,{key:0,title:c(W)?"Switch to light mode theme":"Switch to dark mode theme",onClick:e[0]||(e[0]=o=>c(xe)())},{default:N(()=>[c(W)?(i(),g(l,{key:0})):(i(),g(S,{key:1}))]),_:1},8,["title"]))])]),a("main",{class:"flex-1 h-full of-auto",style:L(`grid-template-columns: repeat(auto-fit,minmax(${P}px,1fr))`),onScroll:H},[(i(!0),b(O,null,q(c(n),(o,f)=>(i(),b("div",{key:o.no,ref_for:!0,ref:u=>x.set(f,u),class:D(["relative border-t border-main of-hidden flex gap-4 min-h-50 group",f===0?"pt5":""])},[a("div",Ke,[a("div",Le,y(f+1),1),w(K,{class:"mr--3 op0 group-hover:op80",title:"Play in new tab",onClick:u=>h(c(G)(o,!1))},{default:N(()=>[w(Q)]),_:2},1032,["onClick"]),I("v-if",!0)]),a("div",{class:"flex flex-col gap-2 my5",style:L({width:`${P}px`})},[a("div",{class:"border rounded border-main overflow-hidden bg-main select-none h-max",onDblclick:u=>h(c(G)(o,!1))},[(i(),g(Ce,{key:o.no,width:P,class:"pointer-events-none important:[&_*]:select-none"},{default:N(()=>[w($e,{"clicks-context":_(o),route:o,"render-context":"overview"},null,8,["clicks-context","route"]),w(Se,{page:o.no},null,8,["page"])]),_:2},1024))],40,ze),V(o)?(i(),g(Ee,{key:0,active:k.value===o,"clicks-context":_(o),class:"w-full mt-2",onDblclick:u=>z(o),onClick:u=>k.value=o},null,8,["active","clicks-context","onDblclick","onClick"])):I("v-if",!0)],4),a("div",Ae,[w(K,{title:"Edit Note",class:D(["rounded-full w-9 h-9 text-sm",v.value===o.no?"important:op0":""]),onClick:u=>v.value=o.no},{default:N(()=>[w(ee)]),_:2},1032,["class","onClick"])]),w(Me,{no:o.no,class:"max-w-250 w-250 text-lg rounded p3","auto-height":!0,highlight:k.value===o,editing:v.value===o.no,"clicks-context":_(o),onDblclick:u=>v.value!==o.no?v.value=o.no:null,"onUpdate:editing":e[1]||(e[1]=u=>v.value=null),onMarkerClick:(u,B)=>Z(u,B,o)},null,8,["no","highlight","editing","clicks-context","onDblclick","onMarkerClick"]),$.value[f]>0?(i(),b("div",Pe,y($.value[f])+" words ",1)):I("v-if",!0)],2))),128))],36),a("div",Re,[a("div",Ue,y(c(n).length)+" slides · "+y(E.value+c(n).length-1)+" clicks · "+y(p.value)+" words ",1)])])}}});export{lt as default};
